<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no">
    <title>小轮顾问</title>
    <!--<script type="text/javascript" src="http://tajs.qq.com/stats?sId=37342703" charset="UTF-8"></script>-->
    <link rel="stylesheet" href="css/frozen.css">
    <link rel="stylesheet" href="css/glor.css">
    <script src="lib/zepto.min.js"></script>
    <script src="js/frozen.js"></script>
</head>

<body ontouchstart>
<section class="ui-container">
    <div class="ui-loading-block hide">
        <div class="ui-loading-cnt">
            <i class="ui-loading-bright"></i>

            <p>正在加载中...</p>
        </div>
    </div>
    <section id="sign-step1">
        <div class="demo-item">
            <div class="ui-tips ui-tips-info">
                <i></i><span>注册小轮顾问后，销售顾问可以接受来自小轮顾问客户派单，帮助客户解决购车过程中遇到的各种问题</span>
            </div>
        </div>
        <div class="demo-item">
            <div class="ui-avatar-lg" style="margin-left: 40%;margin-bottom: 10px;margin-top:10px">
                <span style="background-image:url(http://placeholder.qiniudn.com/140x140)"></span>
            </div>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>
                姓名
            </label>
            <input type="text" id="realName" placeholder="请输入真实姓名"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b" style="display: none;">
            <label>
                性别
            </label>
            <label class="ui-radio" for="sex" style="margin-left:25%">
                <input type="radio" name="sex" value="1"/>男
            </label>
            <label class="ui-radio" for="sex" style="margin-left:5%">
                <input type="radio" name="sex" value="2"/>女
            </label>
            <input type="radio" name="sex" value="0" checked style="display: none;">
        </div>
        <div class="ui-form-item ui-border-b">
            <label>出生日期</label>

            <div class="ui-select-group">
                <div class="ui-select">
                    <select id="year">
                    </select>
                </div>
                <div class="ui-select">
                    <select id="month">
                    </select>
                </div>
                <div class="ui-select">
                    <select id="day">
                    </select>
                </div>
            </div>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>所在城市</label>

            <div class="ui-select-group">
                <div class="ui-select">
                    <select id="cityId">
                    </select>
                </div>
            </div>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>
                工作单位
            </label>
            <input type="text" id="employer" placeholder="请输入单位名称"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>
                工作电话
            </label>
            <input type="text" id="workPhone" placeholder="请输入电话号码"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>服务品牌</label>
            <input type="text" id="servedBrandDesc" class="brand-input" placeholder="选择品牌"/>
            <input type="hidden" id="servedBrandId"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>擅长品牌</label>
            <input type="text" id="expertBrandDesc" class="brand-input" placeholder="选择品牌(可选多个)"/>
            <input type="hidden" id="expertBrandId"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b" style="height:120px">
            <label>
                自我介绍
            </label>
            <textarea id="description" placeholder="不少于100字..." rows="5" style="margin-top:15px"></textarea>
        </div>
        <div class="ui-btn-wrap">
            <button class="ui-btn-lg ui-btn-glor">
                下一步
            </button>
        </div>
    </section>
    <section id="search-brand" style="display: none">
        <div class="demo-item">
            <div class="demo-block">
                <div class="ui-searchbar-wrap ui-border-b">
                    <div class="ui-searchbar ui-border-radius">
                        <i class="ui-icon-search"></i>

                        <div class="ui-searchbar-text">搜索品牌（首字母）</div>
                        <div class="ui-searchbar-input"><input id="key" type="text" placeholder="搜索品牌（首字母）"></div>
                        <i class="ui-icon-close"></i>
                    </div>
                    <button class="ui-searchbar-cancel">取消</button>
                </div>
                <!-- <script src="http://i.gtimg.cn/vipstyle/frozenjs/1.0.1/frozen.js?_bid=304"></script> -->
                <script src="js/frozen.js"></script>
                <script type="text/javascript">
                    $('.ui-searchbar').tap(function () {
                        $('.ui-searchbar-wrap').addClass('focus');
                        $('.ui-searchbar-input input').focus();
                    });
                    $('.ui-searchbar-cancel').tap(function () {
                        $('.ui-searchbar-wrap').removeClass('focus');
                    });
                </script>
            </div>
            <div class="demo-block">
                <ul class="ui-list ui-list-pure ui-border-tb ui-list-mg">
                    <li class="ui-border-t" value="9">
                        <h4>华晨宝马</h4>
                    </li>
                    <li class="ui-border-t" value="20">
                        <h4>北京奔驰</h4>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <section id="sign-step2" style="display: none">
        <div class="demo-item">
            <div class="ui-tips ui-tips-info">
                <i></i><span>请填写验证审核信息</span>
            </div>
        </div>
        <div class="ui-form-item ui-form-item-l ui-border-b">
            <label class="ui-border-r">
                中国 +86
            </label>
            <input type="text" id="phoneNumber" placeholder="请输入手机号码"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-form-item-r ui-border-b">
            <input type="text" placeholder="请输入验证码（暂时免验证）">
            <!-- 若按钮不可点击则添加 disabled 类 -->
            <button type="button" class="ui-border-l">重新发送</button>
            <a href="#" class="ui-icon-close"></a>
        </div>
        <div class="ui-form-item ui-form-item-pure ui-border-b" style="display: none;">
            <input type="password" id="password" placeholder="设置密码">
            <a href="#" class="ui-icon-close"></a>
        </div>
        <div class="ui-form-item ui-form-item-pure ui-border-b" style="display: none;">
            <input type="password" id="passwordSecond" placeholder="验证密码">
            <a href="#" class="ui-icon-close"></a>
        </div>
        <div class="ui-btn-wrap">
            <button class="ui-btn-lg ui-btn-glor">
                完成
            </button>
        </div>
    </section>
    <section id="sign-tips" style="display: none">
        <div class="demo-block">
            <div class="ui-tips ui-tips-success">
                <i></i><span>感谢注册小轮顾问，在审核完成后即可登录使用，接受客户派单联系</span>
            </div>
        </div>
        <div class="ui-btn-wrap">
            <button class="ui-btn-lg ui-btn-glor">
                返回微信
            </button>
        </div>
    </section>
</section>
<script type="text/javascript">

    $.ctx = {};

    for (var y = 1960; y < 2000; ++y) {
        $("#year").append($("<option>" + y + "</option>"));
    }
    for (var m = 1; m < 13; ++m) {
        $("#month").append($("<option>" + m + "</option>"));
    }
    for (var d = 1; d < 32; ++d) {
        $("#day").append($("<option>" + d + "</option>"));
    }

    $.get("head-pic.action", {'size': 132}, function (data) {
        $(".ui-avatar-lg span").css('background-image', 'url(' + data.headPic + ')');
    });

    $.get("city-all.action", function (data) {
        if (!data.errorCode) {
            $(data.cityList).each(function (i, city) {
                $("#cityId").append($("<option value='" + city.cityId + "'>" + city.name + "</option>"));
            });
        }
    });

    $("#sign-step1 button").on('click', function () {
        $(".ui-loading-block").removeClass('hide').addClass('show');
        var postData = {
            'realName': $("#realName").val(),
            'birthday': $("#year").val() + "-" + $("#month").val() + "-" + $("#day").val(),
            'city.cityId': $("#cityId").val(),
            'employer': $("#employer").val(),
            'workPhone': $("#workPhone").val(),
            'servedBrand.entityId': $("#servedBrandId").val(),
            'description': $("#description").val()
        };
        for (var i in $.ctx.expertBrands) {
            postData['expertBrandList[' + i + '].entityId'] = $.ctx.expertBrands[i];
            ++i;
        }
        $.post("seller-register-first.action", postData, function (resp) {
            $(".ui-loading-block").removeClass('show').addClass('hide');
            if (!resp.errorCode) {
                $("#sign-step1").hide();
                $("#sign-step2").show();
            } else {
                alert(resp.errorMessage);
            }
        });
    });

    $("#servedBrandDesc").on('focus', function () {
        $.ctx.brandInputId = "#servedBrandDesc";
        $.ctx.brandInputHiddenId = "#servedBrandId";
        $("#sign-step1").hide();
        $("#search-brand").show();
    });
    $("#expertBrandDesc").on('focus', function () {
        $.ctx.brandInputId = "#expertBrandDesc";
        $.ctx.brandInputHiddenId = "#expertBrandId";
        $("#sign-step1").hide();
        $("#search-brand").show();
    });

    var bindSearchList = function () {
        $("div.demo-block ul li").each(function (i, li) {
            $(li).click(function () {
                if ($.ctx.brandInputId === "#servedBrandDesc") {
                    $($.ctx.brandInputId).val($(li).children("h4").text());
                    $($.ctx.brandInputHiddenId).val($(li).val());
                } else {
                    if ($($.ctx.brandInputId).val() == "") {
                        $($.ctx.brandInputId).val($(li).children("h4").text());
                        $.ctx.expertBrands = [ $(li).val() ];
                    } else {
                        $($.ctx.brandInputId).val($($.ctx.brandInputId).val() + "、" + $(li).children("h4").text());
                        $.ctx.expertBrands.push($(li).val());
                    }
                }
                $("#sign-step1").show();
                $("#search-brand").hide();
            });
        });
    };
    bindSearchList();

    $("#key").on('keyup', function () {
//        $(".ui-loading-block").removeClass('hide').addClass('show');
        $.get("sub-brand-search.action?key=" + $("#key").val(), function (data) {
            if (!data.errorCode) {
                $("div.demo-block ul").empty();
                $(data.subBrandList).each(function (i, brand) {
                    $("div.demo-block ul").append($("<li class='ui-border-t' value='" + brand.subBrandId
                            + "'><h4>" + brand.name + "</h4></li>"));
                });
                bindSearchList();
            }
//            $(".ui-loading-block").removeClass('show').addClass('hide');
        });
    });

    $("#sign-step2 button").on('click', function () {
        $(".ui-loading-block").removeClass('hide').addClass('show');
        $.post("seller-register-last.action", {
            'phoneNumber': $("#phoneNumber").val()
//            'password': $("#password").val(),
//            'passwordSecond': $("#passwordSecond").val()
        }, function (resp) {
            $(".ui-loading-block").removeClass('show').addClass('hide');
            if (!resp.errorCode) {
                $("#sign-step2").hide();
                $("#sign-tips").show();
            } else {
                alert(resp.errorMessage);
            }
        });
    });

    $("#sign-tips button").on('click', function () {
        if (window.WeixinJSBridge && window.WeixinJSBridge.call) {
            window.WeixinJSBridge.call('closeWindow');
        }
    });
</script>
</body>
</html>