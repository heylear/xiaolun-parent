<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no">
    <title>找顾问</title>
    <!--<script type="text/javascript" src="http://tajs.qq.com/stats?sId=37342703" charset="UTF-8"></script>-->
    <link rel="stylesheet" href="css/frozen.css">
    <link rel="stylesheet" href="css/glor.css">
    <script src="lib/zepto.min.js"></script>
    <script src="js/frozen.js"></script>
</head>

<body ontouchstart>
<section class="ui-container">
    <div class="ui-loading-block hide">
        <div class="ui-loading-cnt">
            <i class="ui-loading-bright"></i>

            <p>正在加载中...</p>
        </div>
    </div>
    <section id="sign-step1">
        <div class="demo-item">
            <div class="ui-tips ui-tips-info">
                <i></i><span>填写您的需求，以便为您提供更好的服务</span>
            </div>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>所在城市</label>

            <div class="ui-select-group">
                <div class="ui-select">
                    <select id="cityId">
                    </select>
                </div>
            </div>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>
                意向顾问
            </label>
            <input type="number" id="wantedConsultants" placeholder="请输入意向顾问个数"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>意向品牌</label>
            <input type="text" class="brand-input" placeholder="选择品牌(可选多个)"/>
            <!--<input type="hidden" id="brandId"/>-->
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b" style="height:120px">
            <label>
                详细需求
            </label>
            <textarea id="description" placeholder="有什么问题可以详细描述哦" rows="5" style="margin-top:15px"></textarea>
        </div>
        <div class="ui-btn-wrap">
            <button class="ui-btn-lg ui-btn-glor">
                下一步
            </button>
        </div>
    </section>
    <section id="search-brand" style="display: none">
        <div class="demo-item">
            <div class="demo-block">
                <div class="ui-searchbar-wrap ui-border-b">
                    <div class="ui-searchbar ui-border-radius">
                        <i class="ui-icon-search"></i>

                        <div class="ui-searchbar-text">搜索品牌（首字母）</div>
                        <div class="ui-searchbar-input"><input id="key" type="text" placeholder="搜索号码（首字母）"
                                                               autocapitalize="off"></div>
                        <i class="ui-icon-close"></i>
                    </div>
                    <button class="ui-searchbar-cancel">取消</button>
                </div>
                <!-- <script src="http://i.gtimg.cn/vipstyle/frozenjs/1.0.1/frozen.js?_bid=304"></script> -->
                <script src="js/frozen.js"></script>
                <script type="text/javascript">
                    $('.ui-searchbar').tap(function () {
                        $('.ui-searchbar-wrap').addClass('focus');
                        $('.ui-searchbar-input input').focus();
                    });
                    $('.ui-searchbar-cancel').tap(function () {
                        $('.ui-searchbar-wrap').removeClass('focus');
                    });
                </script>
            </div>
            <div class="demo-block">
                <ul class="ui-list ui-list-pure ui-border-tb ui-list-mg">
                    <li class="ui-border-t" value="9">
                        <h4>华晨宝马</h4>
                    </li>
                    <li class="ui-border-t" value="20">
                        <h4>北京奔驰</h4>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <section id="sign-step2" style="display: none">
        <div class="demo-item">
            <div class="ui-tips ui-tips-info">
                <i></i><span>登记您的信息，方便小轮顾问与您取得联系</span>
            </div>
        </div>
        <div class="demo-item">
            <div class="ui-avatar-lg" style="margin-left: 40%;margin-bottom: 10px;margin-top:10px">
                <span style="background-image:url(http://placeholder.qiniudn.com/140x140)"></span>
            </div>
        </div>
        <div class="ui-form-item ui-border-b">
            <label>
                姓名
            </label>
            <input type="text" id="realName" placeholder="请输入真实姓名"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-border-b" style="display: none;">
            <label>
                性别
            </label>
            <label class="ui-radio" for="radio" style="margin-left:25%">
                <input type="radio" name="sex" value="1" name="radio"/>男
            </label>
            <label class="ui-radio" for="radio" style="margin-left:5%">
                <input type="radio" name="sex" value="2" name="radio"/>女
            </label>
        </div>
        <div class="ui-form-item ui-form-item-l ui-border-b">
            <label class="ui-border-r">
                中国 +86
            </label>
            <input type="text" id="phoneNumber" placeholder="请输入手机号码"/>
            <a href="#" class="ui-icon-close">
            </a>
        </div>
        <div class="ui-form-item ui-form-item-r ui-border-b">
            <input type="text" placeholder="请输入验证码（暂时免验证）">
            <!-- 若按钮不可点击则添加 disabled 类 -->
            <button type="button" class="ui-border-l">重新发送</button>
            <a href="#" class="ui-icon-close"></a>
        </div>
        <div class="ui-form-item ui-form-item-pure ui-border-b" style="display: none;">
            <input type="password" id="password" placeholder="设置密码">
            <a href="#" class="ui-icon-close"></a>
        </div>
        <div class="ui-form-item ui-form-item-pure ui-border-b" style="display: none;">
            <input type="password" id="passwordSecond" placeholder="验证密码">
            <a href="#" class="ui-icon-close"></a>
        </div>
        <div class="ui-btn-wrap">
            <button class="ui-btn-lg ui-btn-glor">
                完成
            </button>
        </div>
    </section>
    <section id="sign-tips" style="display: none">
        <div class="demo-block">
            <div class="ui-tips ui-tips-success">
                <i></i><span>顾问任务单已派发，系统将将根据需求匹配派单，顾问接单后，您可进入我的顾问中查看并联系顾问</span>
            </div>
        </div>
        <div class="ui-btn-wrap">
            <button class="ui-btn-lg ui-btn-glor">
                返回微信
            </button>
        </div>
    </section>
</section>
<script type="text/javascript">
    $.ctx = {};

    $.get("city-all.action", function (data) {
        if (!data.errorCode) {
            $(data.cityList).each(function (i, city) {
                $("#cityId").append($("<option value='" + city.cityId + "'>" + city.name + "</option>"));
            });
        }
    });

    $.get("head-pic.action", {'size': 132}, function (data) {
        $(".ui-avatar-lg span").css('background-image', 'url(' + data.headPic + ')');
    });

    $("#sign-step1 .brand-input").on('focus', function () {
        $("#sign-step1").hide();
        $("#search-brand").show();
    });

    $("#search-brand button").on('click', function () {
        $("#search-brand").hide();
        $("#sign-step1").show();
    });

    $("#key").on('keyup', function () {
//        $(".ui-loading-block").removeClass('hide').addClass('show');
        $.get("sub-brand-search.action?key=" + $("#key").val(), function (data) {
            if (!data.errorCode) {
                $("div.demo-block ul").empty();
                $(data.subBrandList).each(function (i, brand) {
                    $("div.demo-block ul").append($("<li class='ui-border-t' value='" + brand.subBrandId
                    + "'><h4>" + brand.name + "</h4></li>"));
                });
                bindSearchList();
            }
//            $(".ui-loading-block").removeClass('show').addClass('hide');
        });
    });

    var bindSearchList = function () {
        $("#search-brand ul>li").on('click', function () {
            if ($("#sign-step1 .brand-input").val() == "") {
                $("#sign-step1 .brand-input").val($(this).find("h4").html());
            } else {
                $("#sign-step1 .brand-input").val($("#sign-step1 .brand-input").val() + "、" + $(this).find("h4").html());
            }
            if (!$.ctx.brandList) {
                $.ctx.brandList = [];
            }
            $.ctx.brandList.push($(this).val());
            $("#").val($(this).val())
            $("#search-brand").hide();
            $("#sign-step1").show();
        });
    };
    bindSearchList();

    $("#sign-step1 button").on('click', function () {
        $(".ui-loading-block").removeClass('hide').addClass('show');
        var param = {
            "city.cityId": $("#cityId").val(),
            "wantedConsultants": $("#wantedConsultants").val(),
            "description": $("#description").val()
        };
        if ($.ctx.brandList != null) {
            for (var i in $.ctx.brandList) {
                param["subBrandList[" + i + "].entityId"] = $.ctx.brandList[i];
            }
        }
        $.post("customer-consult-input.action", param, function (data) {
            $(".ui-loading-block").removeClass('show').addClass('hide');
            if (!data.errorCode) {
                $("#sign-step1").hide();
                if (data.needRegister) {
                    $("#sign-step2").show();
                } else {
                    $("#sign-tips").show();
                }
            } else {
                alert(data.errorMessage);
            }
        });
    });

    $("#sign-step2 button").on('click', function () {
        $(".ui-loading-block").removeClass('hide').addClass('show');
        $.post("customer-register.action", {
            'realName': $("#realName").val(),
//            'sex': $("input[name='sex']:checked").val(),
            'phoneNumber': $("#phoneNumber").val(),
//            'password': $("#password").val(),
//            'passwordSecond': $("#passwordSecond").val()
        }, function (data) {
            $(".ui-loading-block").removeClass('show').addClass('hide');
            if (!data.errorCode) {
                $("#sign-step2").hide();
                $("#sign-tips").show();
            } else {
                alert(data.errorMessage);
            }
        });
    });

    $("#sign-tips button").on('click', function () {
        if (window.WeixinJSBridge && window.WeixinJSBridge.call) {
            window.WeixinJSBridge.call('closeWindow');
        }
    });
</script>
</body>
</html>